import{_ as y}from"./_plugin-vue_export-helper-c27b6911.js";import{o as h,b as c,e as n,F as u,r as g,t as l,f,p as m,h as x,y as w,k as _}from"./vendor-3de5d8e5.js";class k{constructor(i,e=700){this.endValue=i,this.duration=e}start(i){const e=performance.now(),s=t=>{const r=t-e,a=Math.min(r/this.duration,1),d=Math.floor(a*this.endValue);a<1?requestAnimationFrame(s):i(this.endValue),i(d)};requestAnimationFrame(s)}}const D={props:{data:{type:Array,required:!0},type:{type:String,required:!0}},data(){return{width:600,height:300,paddingLeft:40,paddingRight:20,paddingTop:20,paddingBottom:40,tooltipVisible:!1,tooltipData:{},tooltipPosition:{x:0,y:0},borderVisible:[]}},computed:{points(){const o=(this.height-this.paddingTop-this.paddingBottom)/(this.yMax*1.5);let i;this.type==="daily"?i=this.data.length:this.type==="weekly"?i=Math.min(this.data.length,7):this.type==="monthly"?i=Math.min(this.data.length,30):this.type==="yearly"?i=Math.min(this.data.length,12):i=7;const e=this.data.slice(-i),s=(this.width-this.paddingLeft-this.paddingRight)/(e.length-1);return e.map((t,r)=>({x:this.paddingLeft+r*s,y:this.height-this.paddingBottom-t.y*o,date:t.date}))},linePath(){if(this.points.length<2)return"";let o=`M${this.points[0].x},${this.points[0].y}`;for(let i=1;i<this.points.length;i++){const e=this.points[i-1],s=this.points[i],t=(s.x+e.x)/2;o+=`C${t},${e.y},${t},${s.y},${s.x},${s.y}`}return o},shadowPath(){let o=this.linePath;const i=this.points[this.points.length-1];o+=` L${i.x},${this.height-this.paddingBottom}`;const e=this.points[0];return o+=` L${e.x},${this.height-this.paddingBottom} Z`,o},yMax(){const o=Math.max(...this.data.map(i=>i.y))||1;return o>2?o:2},yScale(){return(this.height-this.paddingTop-this.paddingBottom)/(this.yMax*1.5)},interval(){return this.yMax/2},intervalYScale(){return this.yScale*this.interval}},mounted(){this.$nextTick(()=>{this.width=this.$refs.graph.clientWidth,this.borderVisible=Array(this.points.length).fill(!1)})},methods:{formatDate(o){const i=new Date(o),e=i.getMonth()+1,s=i.getDate();if(this.type==="daily")return`${e}-${s}`;if(this.type==="weekly")return`${e}/${s}`;if(this.type==="monthly"){const t=new Date(i.getFullYear(),i.getMonth(),1),r=Math.ceil((i-t)/(1e3*60*60*24));return`${e}/${r}`}else return this.type==="yearly"?`${i.getFullYear()}/${e}`:`${e}-${s}`},formatNumber(o){return o>=1e12?(o/1e12).toFixed(1)+"t":o>=1e9?(o/1e9).toFixed(1)+"b":o>=1e6?(o/1e6).toFixed(1)+"m":o>=1e3?(o/1e3).toFixed(1)+"k":o},showTooltip(o){this.tooltipVisible=!0,this.tooltipData={date:this.formatTooltipDate(this.data[o].date),pageViews:this.data[o].y};const i=200,e=100,s=i/2,t=e-20,r=Math.min(Math.max(this.points[o].x-s,this.paddingLeft),this.width-this.paddingRight-i),a=this.points[o].y-t;this.tooltipPosition={x:r,y:a}},formatTooltipDate(o){const i=new Date(o),e=i.getFullYear(),s=i.getMonth()+1,t=i.getDate(),r=["日","月","火","水","木","金","土"][i.getDay()];return this.type==="yearly"?`${e}年${s}月`:`${e}年${s}月${t}日(${r})`},hideTooltip(){this.tooltipVisible=!1},showBorder(o){this.borderVisible[o]=!0},hideBorder(){this.borderVisible=this.borderVisible.map(()=>!1)},handleMouseleave(){this.hideBorder(),this.hideTooltip()},handleLineMouseover(o){const i=o.clientX-this.$refs.graph.getBoundingClientRect().left;let e=0,s=Number.MAX_VALUE;this.points.forEach((r,a)=>{const d=Math.abs(r.x-i);d<s&&(s=d,e=a)});const t=this.points[1].x-this.points[0].x;s<t*.5?(this.borderVisible=this.borderVisible.map(()=>!1),this.showBorder(e),this.showTooltip(e)):(this.hideBorder(),this.hideTooltip())}}},p=o=>(m("data-v-f5d8c3c5"),o=o(),x(),o),b={ref:"graph",class:"w-full pt-8 flex justify-center items-center"},v=["height"],S=["x1","y1","x2","y2"],M=["x","y"],V=["x1","y1","x2","y2"],P=p(()=>n("defs",null,[n("linearGradient",{id:"lineShadow",x1:"0",y1:"0",x2:"0",y2:"1"},[n("stop",{offset:"0%","stop-color":"#0076f0","stop-opacity":"0.3"}),n("stop",{offset:"100%","stop-color":"#0076f0","stop-opacity":"0"})])],-1)),C=["d"],T=p(()=>n("animate",{attributeName:"opacity",from:"0",to:"1",dur:".5s",fill:"freeze"},null,-1)),B=[T],L=["d"],N=p(()=>n("animate",{attributeName:"stroke-dasharray",from:"0, 1000",to:"1000, 0",dur:".5s",fill:"freeze"},null,-1)),F=[N],R=["x1","y1","x2","y2","stroke-opacity"],$=["cx","cy","opacity"],I=["x","y"],O=["x","y"],Y={class:"bg-white dark:bg-dark-1 rounded border border-[#dadce0] dark:border-dark-1 p-2 shadow-md"},A={class:"text-[11px] whitespace-nowrap"},X={class:"text-2xl"};function j(o,i,e,s,t,r){return h(),c("div",b,[(h(),c("svg",{class:"graph-svg w-full",height:t.height,preserveAspectRatio:"none",onMousemove:i[0]||(i[0]=(...a)=>r.handleLineMouseover&&r.handleLineMouseover(...a)),onMouseleave:i[1]||(i[1]=(...a)=>r.handleMouseleave&&r.handleMouseleave(...a))},[n("line",{x1:t.paddingLeft,y1:t.height-t.paddingBottom,x2:t.width-t.paddingRight,y2:t.height-t.paddingBottom,stroke:"#dadce0","stroke-width":"2"},null,8,S),(h(),c(u,null,g(3,a=>n("g",{key:a},[n("text",{x:t.paddingLeft-10,y:t.height-t.paddingBottom-a*r.intervalYScale,"text-anchor":"end","font-size":"12"},l(r.formatNumber(a*r.interval)),9,M),n("line",{x1:t.paddingLeft,y1:t.height-t.paddingBottom-a*r.intervalYScale,x2:t.width-t.paddingRight,y2:t.height-t.paddingBottom-a*r.intervalYScale,style:{stroke:"rgb(218, 220, 224)"}},null,8,V)])),64)),P,n("path",{d:r.shadowPath,fill:"url(#lineShadow)"},B,8,C),n("g",null,[n("path",{d:r.linePath,fill:"none",stroke:"#0076f0","stroke-width":"4"},F,8,L)]),(h(!0),c(u,null,g(r.points,(a,d)=>(h(),c("g",{key:d},[n("line",{x1:a.x,y1:t.height-t.paddingBottom,x2:a.x,y2:t.height-t.paddingBottom-r.intervalYScale*3,"stroke-opacity":t.borderVisible[d]?1:0,stroke:"#bbb","stroke-width":"1","stroke-dasharray":"2,2"},null,8,R),n("circle",{cx:a.x,cy:a.y,r:"4",class:"rounded-full fill-primary z-50",opacity:t.borderVisible[d]?1:0},null,8,$),n("text",{x:a.x,y:t.height-t.paddingBottom+20,"text-anchor":"middle","font-size":"12"},l(r.formatDate(a.date)),9,I)]))),128)),t.tooltipVisible?(h(),c("foreignObject",{key:0,x:t.tooltipPosition.x,y:t.tooltipPosition.y,width:"200",height:"100"},[n("div",Y,[n("p",A,l(t.tooltipData.date)+l(o.t("のページビュー")),1),n("p",X,l(r.formatNumber(t.tooltipData.pageViews)),1)])],8,O)):f("",!0)],40,v))],512)}const q=y(D,[["render",j],["__scopeId","data-v-f5d8c3c5"]]),z={components:{LineChart:q},props:{pageViews:{type:Array,required:!0}},data(){return{book:this.pageViews[0].book,animatedCount:0,menuVisible:!1,period:"weekly"}},computed:{setPeriodWord(){return this.period==="daily"?this.t("daily"):this.period==="weekly"?this.t("weekly"):this.period==="monthly"?this.t("monthly"):this.period==="yearly"?this.t("yearly"):this.t("weekly")},toChartData(){return this.period==="daily"?this.dailyData:this.period==="weekly"?this.weeklyData:this.period==="monthly"?this.monthlyData:this.period==="yearly"?this.yearlyData:!1},dailyData(){const o=this.pageViews.reduce((t,r)=>{const a=r.created_at.split("T")[0];return t[a]||(t[a]=0),t[a]+=1,t},{}),i=[],s=new Date().toISOString().split("T")[0];return i.push({date:s,count:o[s]||0}),i.map((t,r)=>({x:r,y:isNaN(t.count)?0:t.count,date:t.date}))},weeklyData(){const o=this.pageViews.reduce((e,s)=>{const t=s.created_at.split("T")[0];return e[t]||(e[t]=0),e[t]+=1,e},{}),i=[];for(let e=6;e>=0;e--){const s=new Date;s.setDate(s.getDate()-e);const t=s.toISOString().split("T")[0];i.push({date:t,count:o[t]||0})}return i.map((e,s)=>({x:s,y:isNaN(e.count)?0:e.count,date:e.date}))},monthlyData(){const o=this.pageViews.reduce((e,s)=>{const r=new Date(s.created_at).toISOString().split("T")[0];return e[r]||(e[r]=0),e[r]+=1,e},{}),i=[];for(let e=29;e>=0;e--){const s=new Date;s.setDate(s.getDate()-e);const t=s.toISOString().split("T")[0];i.push({date:t,count:o[t]||0})}return i.map((e,s)=>({x:s,y:isNaN(e.count)?0:e.count,date:e.date}))},yearlyData(){const o=this.pageViews.reduce((e,s)=>{const t=new Date(s.created_at);t.setMonth(t.getMonth(),1);const r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-01`;return e[r]||(e[r]=0),e[r]+=1,e},{}),i=[];for(let e=11;e>=0;e--){const s=new Date;s.setMonth(s.getMonth()-e,1);const t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-01`;i.push({date:t,count:o[t]||0})}return i.map((e,s)=>({x:s,y:isNaN(e.count)?0:e.count,date:e.date}))},linePath(){return this.weeklyData.reduce((i,e,s)=>{if(s===0)return`M ${e.x} ${e.y}`;const t=this.weeklyData[s-1],r=(t.x+e.x)/2;return`${i} Q ${t.x} ${t.y}, ${r} ${t.y} T ${e.x} ${e.y}`},"")},growthRate(){return this.calculateGrowthRate(this.period)}},mounted(){new k(this.pageViews.length).start(i=>{this.animatedCount=i})},methods:{toggleMenu(){this.menuVisible=!this.menuVisible},setPeriod(o){this.period=o,this.menuVisible=!1},calculateGrowthRate(o){const i=this.toChartData,e=this.getPreviousPeriodData(o),s=i.reduce((a,d)=>a+d.y,0),t=e.reduce((a,d)=>a+d.y,0);return t===0?s>0?100:0:((s-t)/t*100).toFixed(2)},getPreviousPeriodData(o){if(o==="daily"){const i=new Date;i.setDate(i.getDate()-2);const e=i.toISOString().split("T")[0];return[{y:this.pageViews.filter(t=>t.created_at.split("T")[0]===e).length}]}if(o==="weekly"){const i=[];for(let e=13;e>=7;e--){const s=new Date;s.setDate(s.getDate()-e);const t=s.toISOString().split("T")[0],r=this.pageViews.filter(a=>a.created_at.split("T")[0]===t).length;i.push({y:r})}return i}if(o==="monthly"){const i=[];for(let e=59;e>=30;e--){const s=new Date;s.setDate(s.getDate()-e);const t=s.toISOString().split("T")[0],r=this.pageViews.filter(a=>a.created_at.split("T")[0]===t).length;i.push({y:r})}return i}if(o==="yearly"){const i=[];for(let e=23;e>=12;e--){const s=new Date;s.setMonth(s.getMonth()-e,1);const t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-01`,r=this.pageViews.filter(a=>a.created_at.split("T")[0]===t).length;i.push({y:r})}return i}}}},W={class:"w-full"},G=n("h3",{class:"text-xs text-[#9aa0a6] leading-6"},"作品名",-1),E={class:"text-3xl mb-8"},Z={class:"w-full p-4 lg:p-10 border border-[#dadce0] dark:border-dark-1 rounded-lg"},U={class:"flex justify-between"},H=n("h3",{class:"text-xs text-[#9aa0a6] leading-6"}," ページビュー ",-1),Q={class:"flex items-center"},J={class:"lg:text-[28px] text-2xl"},K=n("svg",{height:"18",class:"ml-2",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M15.5799 11.9999C15.5799 13.9799 13.9799 15.5799 11.9999 15.5799C10.0199 15.5799 8.41992 13.9799 8.41992 11.9999C8.41992 10.0199 10.0199 8.41992 11.9999 8.41992C13.9799 8.41992 15.5799 10.0199 15.5799 11.9999Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),n("path",{d:"M12.0001 20.2702C15.5301 20.2702 18.8201 18.1902 21.1101 14.5902C22.0101 13.1802 22.0101 10.8102 21.1101 9.40021C18.8201 5.80021 15.5301 3.72021 12.0001 3.72021C8.47009 3.72021 5.18009 5.80021 2.89009 9.40021C1.99009 10.8102 1.99009 13.1802 2.89009 14.5902C5.18009 18.1902 8.47009 20.2702 12.0001 20.2702Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),tt={class:"flex items-center text-[#2BB974] text-sm"},et=n("svg",{class:"mr-1",width:"18",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941"})],-1),it={class:""},st={class:"relative"},ot={key:0,class:"absolute bg-white dark:bg-dark-1 border border-[#dadce0] dark:border-dark-1 rounded-lg p-2 mt-2"};function rt(o,i,e,s,t,r){const a=w("line-chart");return h(),c("div",W,[G,n("div",E,l(t.book.title),1),n("div",Z,[n("div",U,[n("div",null,[H,n("div",Q,[n("span",J,l(t.animatedCount),1),K]),n("div",tt,[et,n("span",it,l(r.growthRate===1/0?"∞":r.growthRate+"%"),1)])]),n("div",st,[n("div",{class:"cursor-pointer px-4 py-1.5 border border-[#dadce0] dark:border-dark-1 rounded-lg",onClick:i[0]||(i[0]=(...d)=>r.toggleMenu&&r.toggleMenu(...d))},l(r.setPeriodWord),1),t.menuVisible?(h(),c("div",ot,[n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary dark:hover:text-f5 whitespace-nowrap",onClick:i[1]||(i[1]=d=>r.setPeriod("daily"))},l(o.t("1日")),1),n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary dark:hover:text-f5 whitespace-nowrap",onClick:i[2]||(i[2]=d=>r.setPeriod("weekly"))},l(o.t("1週間")),1),n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary dark:hover:text-f5 whitespace-nowrap",onClick:i[3]||(i[3]=d=>r.setPeriod("monthly"))},l(o.t("1ヶ月")),1),n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary dark:hover:text-f5 whitespace-nowrap",onClick:i[4]||(i[4]=d=>r.setPeriod("yearly"))},l(o.t("1年間")),1)])):f("",!0)])]),_(a,{data:r.toChartData,type:r.setPeriodWord},null,8,["data","type"])])])}const dt=y(z,[["render",rt]]);export{dt as default};
