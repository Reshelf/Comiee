import{_ as g}from"./_plugin-vue_export-helper-c27b6911.js";import{o as l,c as p,a as n,F as c,r as y,t as h,f,b as m,g as x,h as w}from"./app-f71f6793.js";class _{constructor(i,e=700){this.endValue=i,this.duration=e}start(i){const e=performance.now(),o=t=>{const r=t-e,a=Math.min(r/this.duration,1),d=Math.floor(a*this.endValue);a<1?requestAnimationFrame(o):i(this.endValue),i(d)};requestAnimationFrame(o)}}const k={props:{data:{type:Array,required:!0},type:{type:String,required:!0}},data(){return{width:600,height:300,paddingLeft:40,paddingRight:20,paddingTop:20,paddingBottom:40,tooltipVisible:!1,tooltipData:{},tooltipPosition:{x:0,y:0}}},computed:{points(){const s=(this.height-this.paddingTop-this.paddingBottom)/(this.yMax*2);let i;this.type==="daily"?i=this.data.length:this.type==="weekly"?i=Math.min(this.data.length,7):this.type==="monthly"?i=Math.min(this.data.length,30):this.type==="yearly"?i=Math.min(this.data.length,12):i=7;const e=this.data.slice(-i),o=(this.width-this.paddingLeft-this.paddingRight)/(e.length-1);return e.map((t,r)=>({x:this.paddingLeft+r*o,y:this.height-this.paddingBottom-t.y*s}))},linePath(){if(this.points.length<2)return"";let s=`M${this.points[0].x},${this.points[0].y}`;for(let i=1;i<this.points.length;i++){const e=this.points[i-1],o=this.points[i],t=(o.x+e.x)/2;s+=`C${t},${e.y},${t},${o.y},${o.x},${o.y}`}return s},shadowPath(){let s=this.linePath;const i=this.points[this.points.length-1];s+=` L${i.x},${this.height-this.paddingBottom}`;const e=this.points[0];return s+=` L${e.x},${this.height-this.paddingBottom} Z`,s},yMax(){return Math.max(...this.data.map(s=>s.y))||1},yScale(){return(this.height-this.paddingTop-this.paddingBottom)/(this.yMax*2)},interval(){return this.yMax/2},intervalYScale(){return this.yScale*this.interval}},mounted(){this.$nextTick(()=>{this.width=this.$refs.graph.clientWidth})},methods:{formatDate(s){const i=new Date(s);return this.type==="daily"?`${i.getMonth()+1}-${i.getDate()}`:this.type==="weekly"?`${i.getMonth()+1}-${i.getDate()}`:this.type==="monthly"?`${i.getMonth()+1}-${i.getFullYear()}`:this.type==="yearly"?`${i.getFullYear()}`:`${i.getMonth()+1}-${i.getDate()}`},formatNumber(s){return s>=1e12?(s/1e12).toFixed(1)+"t":s>=1e9?(s/1e9).toFixed(1)+"b":s>=1e6?(s/1e6).toFixed(1)+"m":s>=1e3?(s/1e3).toFixed(1)+"k":s},showTooltip(s){this.tooltipVisible=!0,this.tooltipData={pageViews:this.data[s].y},this.tooltipPosition={x:this.points[s].x-50,y:this.points[s].y-70}},hideTooltip(){this.tooltipVisible=!1}}},D={ref:"graph",class:"w-full pt-8 flex justify-center items-center"},b=["height"],v=["x1","y1","x2","y2"],S=["x","y"],M=["x1","y1","x2","y2"],C=n("defs",null,[n("linearGradient",{id:"lineShadow",x1:"0",y1:"0",x2:"0",y2:"1"},[n("stop",{offset:"0%","stop-color":"#0076f0","stop-opacity":"0.3"}),n("stop",{offset:"100%","stop-color":"#0076f0","stop-opacity":"0"})])],-1),V=["d"],P=n("animate",{attributeName:"opacity",from:"0",to:"1",dur:".5s",fill:"freeze"},null,-1),T=[P],N=["d"],B=n("animate",{attributeName:"stroke-dasharray",from:"0, 1000",to:"1000, 0",dur:".5s",fill:"freeze"},null,-1),F=[B],$=["cx","cy","onMouseover"],L=["x","y"],Y=["x","y"],j={class:"bg-white rounded text-xs border border-[#dadce0] dark:border-dark-1 p-2"},q={class:"text-2xl"};function z(s,i,e,o,t,r){return l(),p("div",D,[(l(),p("svg",{class:"w-full",height:t.height},[n("line",{x1:t.paddingLeft,y1:t.height-t.paddingBottom,x2:t.width-t.paddingRight,y2:t.height-t.paddingBottom,stroke:"#dadce0","stroke-width":"2"},null,8,v),(l(),p(c,null,y(4,a=>n("g",{key:a},[n("text",{x:t.paddingLeft-10,y:t.height-t.paddingBottom-a*r.intervalYScale,"text-anchor":"end","font-size":"12"},h(r.formatNumber(a*r.interval)),9,S),n("line",{x1:t.paddingLeft,y1:t.height-t.paddingBottom-a*r.intervalYScale,x2:t.width-t.paddingRight,y2:t.height-t.paddingBottom-a*r.intervalYScale,style:{stroke:"rgb(218, 220, 224)"}},null,8,M)])),64)),C,n("path",{d:r.shadowPath,fill:"url(#lineShadow)"},T,8,V),n("g",null,[n("path",{d:r.linePath,fill:"none",stroke:"#0076f0","stroke-width":"4"},F,8,N)]),(l(!0),p(c,null,y(r.points,(a,d)=>(l(),p("g",{key:d},[n("circle",{cx:a.x,cy:a.y,r:"4",class:"rounded-full opacity-0 hover:opacity-100 fill-primary cursor-pointer z-50",onMouseover:u=>r.showTooltip(d),onMouseout:i[0]||(i[0]=(...u)=>r.hideTooltip&&r.hideTooltip(...u))},null,40,$),n("text",{x:a.x,y:t.height-t.paddingBottom+20,"text-anchor":"middle","font-size":"12"},h(r.formatDate(e.data[d].date)),9,L)]))),128)),t.tooltipVisible?(l(),p("foreignObject",{key:0,x:t.tooltipPosition.x,y:t.tooltipPosition.y,width:"100",height:"100"},[n("div",j,[f(h(s.t("ページビュー"))+" ",1),n("p",q,h(r.formatNumber(t.tooltipData.pageViews)),1)])],8,Y)):m("",!0)],8,b))],512)}const O=g(k,[["render",z]]),A={components:{LineChart:O},props:{pageViews:{type:Array,required:!0}},data(){return{book:this.pageViews[0].book,animatedCount:0,menuVisible:!1,period:"weekly"}},computed:{setPeriodWord(){return this.period==="daily"?this.t("daily"):this.period==="weekly"?this.t("weekly"):this.period==="monthly"?this.t("monthly"):this.period==="yearly"?this.t("yearly"):this.t("weekly")},toChartData(){return this.period==="daily"?this.dailyData:this.period==="weekly"?this.weeklyData:this.period==="monthly"?this.monthlyData:this.period==="yearly"?this.yearlyData:!1},dailyData(){const s=this.pageViews.reduce((t,r)=>{const a=r.created_at.split("T")[0];return t[a]||(t[a]=0),t[a]+=1,t},{}),i=[],o=new Date().toISOString().split("T")[0];return i.push({date:o,count:s[o]||0}),i.map((t,r)=>({x:r,y:isNaN(t.count)?0:t.count,date:t.date}))},weeklyData(){const s=this.pageViews.reduce((e,o)=>{const t=o.created_at.split("T")[0];return e[t]||(e[t]=0),e[t]+=1,e},{}),i=[];for(let e=6;e>=0;e--){const o=new Date;o.setDate(o.getDate()-e);const t=o.toISOString().split("T")[0];i.push({date:t,count:s[t]||0})}return i.map((e,o)=>({x:o,y:isNaN(e.count)?0:e.count,date:e.date}))},monthlyData(){const s=this.pageViews.reduce((e,o)=>{const t=new Date(o.created_at);t.setDate(1);const r=t.toISOString().split("T")[0];return e[r]||(e[r]=0),e[r]+=1,e},{}),i=[];for(let e=29;e>=0;e--){const o=new Date;o.setDate(o.getDate()-e),o.setDate(1);const t=o.toISOString().split("T")[0];i.push({date:t,count:s[t]||0})}return i.map((e,o)=>({x:o,y:isNaN(e.count)?0:e.count,date:e.date}))},yearlyData(){const s=this.pageViews.reduce((e,o)=>{const t=new Date(o.created_at);t.setMonth(t.getMonth(),1);const r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-01`;return e[r]||(e[r]=0),e[r]+=1,e},{}),i=[];for(let e=11;e>=0;e--){const o=new Date;o.setMonth(o.getMonth()-e,1);const t=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-01`;i.push({date:t,count:s[t]||0})}return i.map((e,o)=>({x:o,y:isNaN(e.count)?0:e.count,date:e.date}))},linePath(){return this.weeklyData.reduce((i,e,o)=>{if(o===0)return`M ${e.x} ${e.y}`;const t=this.weeklyData[o-1],r=(t.x+e.x)/2;return`${i} Q ${t.x} ${t.y}, ${r} ${t.y} T ${e.x} ${e.y}`},"")}},mounted(){new _(this.pageViews.length).start(i=>{this.animatedCount=i})},methods:{toggleMenu(){this.menuVisible=!this.menuVisible},setPeriod(s){this.period=s,this.menuVisible=!1}}},I={class:"my-8"},R=n("h3",{class:"text-xs text-[#9aa0a6] leading-6"},"作品名",-1),W={class:"text-3xl mb-8"},Z={class:"p-4 lg:p-10 border border-[#dadce0] dark:border-dark-1 rounded-lg"},G={class:"flex justify-between"},X=n("h3",{class:"text-xs text-[#9aa0a6] leading-6"}," ページビュー ",-1),E={class:"flex items-center"},Q={class:"lg:text-[28px] text-2xl"},U=n("svg",{height:"18",class:"ml-2",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M15.5799 11.9999C15.5799 13.9799 13.9799 15.5799 11.9999 15.5799C10.0199 15.5799 8.41992 13.9799 8.41992 11.9999C8.41992 10.0199 10.0199 8.41992 11.9999 8.41992C13.9799 8.41992 15.5799 10.0199 15.5799 11.9999Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),n("path",{d:"M12.0001 20.2702C15.5301 20.2702 18.8201 18.1902 21.1101 14.5902C22.0101 13.1802 22.0101 10.8102 21.1101 9.40021C18.8201 5.80021 15.5301 3.72021 12.0001 3.72021C8.47009 3.72021 5.18009 5.80021 2.89009 9.40021C1.99009 10.8102 1.99009 13.1802 2.89009 14.5902C5.18009 18.1902 8.47009 20.2702 12.0001 20.2702Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),H={class:"relative"},J={key:0,class:"absolute bg-white border border-[#dadce0] dark:border-dark-1 rounded-lg p-2 mt-2"};function K(s,i,e,o,t,r){const a=x("line-chart");return l(),p("div",I,[R,n("div",W,h(t.book.title),1),n("div",Z,[n("div",G,[n("div",null,[X,n("div",E,[n("span",Q,h(t.animatedCount),1),U])]),n("div",H,[n("div",{class:"cursor-pointer px-4 py-1.5 border border-[#dadce0] dark:border-dark-1 rounded-lg",onClick:i[0]||(i[0]=(...d)=>r.toggleMenu&&r.toggleMenu(...d))},h(r.setPeriodWord),1),t.menuVisible?(l(),p("div",J,[n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary whitespace-nowrap",onClick:i[1]||(i[1]=d=>r.setPeriod("daily"))},h(s.t("1日")),1),n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary whitespace-nowrap",onClick:i[2]||(i[2]=d=>r.setPeriod("weekly"))},h(s.t("1週間")),1),n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary whitespace-nowrap",onClick:i[3]||(i[3]=d=>r.setPeriod("monthly"))},h(s.t("1ヶ月")),1),n("div",{class:"cursor-pointer py-1 px-3 hover:text-primary whitespace-nowrap",onClick:i[4]||(i[4]=d=>r.setPeriod("yearly"))},h(s.t("1年間")),1)])):m("",!0)])]),w(a,{data:r.toChartData,type:r.setPeriodWord},null,8,["data","type"])])])}const it=g(A,[["render",K]]);export{it as default};
